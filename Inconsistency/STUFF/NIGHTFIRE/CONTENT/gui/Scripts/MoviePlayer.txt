 

GUI_VARIABLE_STRING
	NAME _gui_mainmenu
	VALUE "gui/Scripts/Mainmenu/Nightfire.txt"
END
GUI_VARIABLE_STRING
	NAME _gui_escapemenu
	VALUE "gui/Scripts/Escapemenu/menu.txt"
END
GUI_VARIABLE_STRING
	NAME _gui_escapempmenu
	VALUE "gui/Scripts/Escapemenu/mpmenu.txt"
END
GUI_VARIABLE_STRING
	NAME _gui_intro
	VALUE "gui/Scripts/intro.txt"
END
GUI_VARIABLE_STRING
	NAME _gui_movieplayer
	VALUE "gui/Scripts/MoviePlayer.txt"
END
GUI_VARIABLE_STRING
	NAME THIS_MENU
END
GUI_VARIABLE_STRING
	NAME THIS_GENERIC
END



GUI_VARIABLE_MOVIE
	NAME themovie
#	TEXTURE m1_intro.avi
	LOOPING FALSE
	AUDIO TRUE
	EXCLUSIVE TRUE
END

GUI_VARIABLE_FLOAT
	NAME movieTimer
	INITIAL_VALUE 0
	MIN_VALUE 0
	MAX_VALUE 20000		#about 5.5 hours!
	LERP_TIME 20000		
	WRAP FALSE
	LOOP FALSE
END

GUI_VARIABLE_FLOAT
	NAME movieExitTime
	INITIAL_VALUE 0
	MIN_VALUE 0
	MAX_VALUE 20000
END
GUI_VARIABLE_FLOAT
	NAME old_mastervolume
	INITIAL_VALUE 0
	MIN_VALUE 0
	MAX_VALUE 1
END
GUI_VARIABLE_FLOAT
	NAME snd_mastervolume # a cvar
	INITIAL_VALUE 0
	MIN_VALUE 0
	MAX_VALUE 1
END

GUI_FLAGS
#	USE_CURSOR
	USE_INPUT
	BLOCK_CURSOR
	BLOCK_FRAME
	BLOCK_INPUT
	DYNAMIC
#	PAUSE
	UNIQUE
END

ON_CLOSE GUI_COMMAND EQUALS initialized 1 ShutdownMoviePlayer END

GUI_ACTION
	NAME ExitMovie
	
	GUI_COMMAND GUI_ACTION_MOVIE_VARIABLE themovie FREE END
	GUI_COMMAND GUI_ACTION_VCR_VARIABLE movieTimer PAUSE END
	GUI_COMMAND GUI_ACTION_EXIT END 
END

GUI_ACTION
	NAME TryExitMovie
	
	GUI_COMMAND GREATERTHAN movieTimer movieExitTime ExitMovie END
END

GUI_VARIABLE_FLOAT
	NAME initialized
	INITIAL_VALUE 0
	MIN_VALUE 0
	MAX_VALUE 1
END
GUI_ACTION
	NAME InitializeMoviePlayer
	
	GUI_COMMAND GUI_ACTION_DIALOG LOADACTION GUI_ACTION_MUSIC END
	GUI_COMMAND GUI_ACTION_MUSIC PAUSEALL END
	
	GUI_COMMAND GUI_ACTION_VCR_VARIABLE movieTimer REWIND END
	GUI_COMMAND GUI_ACTION_VCR_VARIABLE movieTimer PLAY END
	GUI_COMMAND GUI_ACTION_SET_VARIABLE initialized 1 END
	
	# store off the master volume and zero it
	GUI_COMMAND GUI_ACTION_SET_VARIABLE_VARIABLE old_mastervolume snd_mastervolume END
	GUI_COMMAND GUI_ACTION_SET_VARIABLE snd_mastervolume 0 END
END
GUI_ACTION
	NAME ShutdownMoviePlayer
	
	GUI_COMMAND GUI_ACTION_MUSIC RESUMEALL END
	GUI_COMMAND GUI_ACTION_SET_VARIABLE_VARIABLE snd_mastervolume old_mastervolume END
END

GUI_SCREEN
	NAME MovieScreen

	FADE_IN_TIME 0.25
	FADE_OUT_TIME 0.25
	
	MATERIAL_INFO
		MATERIAL solid
		COLOR 0 0 0 255
	END
	
	GUI_GENERIC
		NAME initializer
		Z_PLANE 1
		ON_RENDER GUI_COMMAND EQUALS initialized 0 InitializeMoviePlayer END
		GUI_INPUT
			CANCEL		GUI_COMMAND TryExitMovie END
		END	
	END
	
	GUI_GENERIC
		NAME MovieView
		Z_PLANE 1
		
		SCREEN_RECT_LTWH 0 0 640 480
		
		MATERIAL_INFO
			MATERIAL frontend
			TEXTURE @themovie
			COLOR 255 255 255 0
		END
		
		GUI_DEPENDENCY
			NAME themovie
			STATE_SELECTION_LINEAR FALSE
			GUI_ELEMENT_STATE
				DEPENDS_VALUE 0.0	#not ready
				MATERIAL_INFO
					COLOR 255 255 255 0
				END
				ON_RENDER GUI_COMMAND ExitMovie END
			END
			GUI_ELEMENT_STATE
				DEPENDS_VALUE 1.0	#loaded
				ON_RENDER GUI_COMMAND GUI_ACTION_MOVIE_VARIABLE themovie PLAY END
				MATERIAL_INFO
					COLOR 255 255 255 255
				END
			END
			GUI_ELEMENT_STATE
				DEPENDS_VALUE 2.0	#playing
				ON_RENDER GUI_COMMAND GUI_ACTION_MOVIE_VARIABLE themovie UPDATE END
				MATERIAL_INFO
					COLOR 255 255 255 255
				END
			END
			GUI_ELEMENT_STATE
				DEPENDS_VALUE 3.0	#stopped
				ON_RENDER GUI_COMMAND ExitMovie END
				MATERIAL_INFO
					COLOR 255 255 255 0
				END
			END
			GUI_ELEMENT_STATE
				DEPENDS_VALUE 4.0	#finished
				ON_RENDER GUI_COMMAND ExitMovie END
				MATERIAL_INFO
					COLOR 255 255 255 0
				END
			END
		END
		
	END
END
